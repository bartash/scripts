if [ -z "$DISPLAY" ]; then
  # for cloudcat machines
  export DISPLAY=:3
fi

# run newest clion
CLION=`ls -td ~/bin/clion-* | head -1`

if [ -z "$CLION" ];
then
   echo no clion in bin
   exit 1
fi

if [ "$#" -ge 5 ]
then
    # prevent 'cl *' which really sucks
	echo "$0: too many arguments, are you sure?"
	exit 1;
fi

echo running $CLION

# on gce I also had 
# . $IMPALA_HOME/bin/set-classpath.sh
 
cd $IMPALA_HOME

set -euo pipefail
. $IMPALA_HOME/bin/report_build_error.sh
setup_report_build_error
   
. $IMPALA_HOME/bin/set-pythonpath.sh

LD_LIBRARY_PATH+=":$(python "$IMPALA_HOME/infra/python/bootstrap_virtualenv.py" \
  --print-ld-library-path)"

PY_DIR="$IMPALA_HOME/infra/python"
python "$PY_DIR/bootstrap_virtualenv.py"



# allow clion diff file1 file2
$CLION/bin/clion.sh $* |& grep -v 'Everything has changed'

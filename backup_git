#!/bin/sh
# backup by cloning
# create clone with 'cd /Volumes/Elvis/backups/cdh; git clone --mirror ~/git/cdh/hive'
#
# try 'git config gc.auto 256' to force more packing 
# see https://stackoverflow.com/questions/16337498/understanding-git-gc-auto
#
while getopts g opts; do
   case ${opts} in
      g) 
	GC=true 
	;;
      *) 
	echo "usage: $0 [-g]"
        exit 0
        ;;
   esac
done

# where backups are stored
BACKUP_HOME=/Volumes/Elvis/backups
# list of repos to backup
REPO_NAMES=( \
	asf/hadoop.git  \
	asf/hive-iml.git \
	asf/hive.git  \
	asf/hive2.git  \
	cdh/hadoop.git \
	cdh/hive-iml.git \
	cdh/hive.git \
	cdh/hive2-iml.git \
	cdh/hive2.git \
	cdh/hive3.git \
	scripts.git \
	)
for repoName in "${REPO_NAMES[@]}"
do
	repos=${BACKUP_HOME}/$repoName
	echo $repos
	cd $repos
	git remote update

	if [ -z "$GC" ]
	then
		# echo no gc
		git gc --auto
	else
		# echo with gc
		git gc
		# if you see 
		#   warning: unable to unlink ./objects/ff/d0439f332f0ac20314b6f413e149596b493411: Operation not permitted
		# then run
		#   chflags -R nouchg *
	fi
 	echo '------------------------'
done


